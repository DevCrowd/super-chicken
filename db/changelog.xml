<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
    <changeSet id="speaker" author="spc">
        <sqlFile path="db/create-schema.sql" splitStatements="false" />
    </changeSet>
    <changeSet id="participants" author="spc">
        <sql>
        create table participants(
		    id VARCHAR(50) PRIMARY KEY,
		    name VARCHAR(30) NOT NULL,
		    surname VARCHAR(30) NOT NULL,
		    email VARCHAR(50) NOT NULL,
		    voted BOOLEAN,
		    attended BOOLEAN,
		    tee_size VARCHAR(3),
		    origin VARCHAR(100)
		);
        </sql>
    </changeSet>
    <changeSet id="vote-fix" author="spc" >
        <sql splitStatements="false">
            CREATE OR REPLACE FUNCTION vote(in varchar, in int) RETURNS integer AS $$
			BEGIN
			    IF NOT EXISTS (SELECT 1 FROM votes WHERE presentation_id = $1) THEN
			        INSERT INTO votes VALUES ($1, $2);
			    ELSE
			       UPDATE votes SET votes = votes + $2 WHERE presentation_id = $1;
			    END IF;
			
			    RETURN null;
			END;
			$$ LANGUAGE plpgsql;
        </sql>
    </changeSet>
    <changeSet id="picture-backup" author="spc" >
        <sql splitStatements="false">
            create table speaker_picture_backup(
                speaker_id VARCHAR(50) PRIMARY KEY,
                picture TEXT
            );
        </sql>
    </changeSet>
</databaseChangeLog>